<?xml version="1.0" encoding="utf-8"?>
<local:DetailPaneBase
	x:Class="MediaDeck.Views.Panes.DetailPanes.TagsDetail"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:MediaDeck.Views.Panes.DetailPanes"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:controls="using:CommunityToolkit.WinUI.Controls"
	xmlns:ui="using:CommunityToolkit.WinUI"
	xmlns:tags="using:MediaDeck.ViewModels.Tags"
	xmlns:files="using:MediaDeck.Models.Files"
	mc:Ignorable="d">

	<StackPanel x:Name="ControlRoot" Spacing="8">
		<!-- Header -->
		<StackPanel Orientation="Horizontal" Spacing="8">
			<FontIcon Glyph="&#xE8EC;" FontSize="14"/>
			<TextBlock Text="Tags" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
		</StackPanel>

		<!-- Add Tag Input -->
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>
			<AutoSuggestBox
				Grid.Column="0"
				ItemsSource="{x:Bind ViewModel.FilteredTagCandidates, Mode=OneWay}"
				PlaceholderText="Add tags..."
				Text="{x:Bind ViewModel.Text.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
				TextMemberPath="TagName"
				TextChanged="AutoSuggestBox_TextChanged"
				PreviewKeyDown="AutoSuggestBox_PreviewKeyDown">
				<AutoSuggestBox.ItemTemplate>
					<DataTemplate x:DataType="files:TagModel">
						<StackPanel Spacing="2" Padding="4">
							<TextBlock Text="{x:Bind TagName}"/>
							<TextBlock
								Text="{x:Bind RepresentativeText.Value, Mode=OneWay}"
								Style="{ThemeResource CaptionTextBlockStyle}"
								Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
						</StackPanel>
					</DataTemplate>
				</AutoSuggestBox.ItemTemplate>
			</AutoSuggestBox>
			<Button
				Grid.Column="1"
				Margin="8,0,0,0"
				Content="Add"
				Command="{x:Bind ViewModel.AddTagCommand}"/>
		</Grid>

		<!-- Tag List -->
		<ListBox
			x:Name="TagListBox"
			ItemsSource="{x:Bind ViewModel.Tags, Mode=OneWay}"
			Background="Transparent"
			BorderThickness="0"
			Padding="0"
			MinHeight="40"
			ScrollViewer.VerticalScrollMode="Auto">
			<ListBox.ItemContainerStyle>
				<Style TargetType="ListBoxItem">
					<Setter Property="Padding" Value="8,4"/>
					<Setter Property="Margin" Value="0,0,4,4"/>
					<Setter Property="Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}"/>
					<Setter Property="CornerRadius" Value="4"/>
				</Style>
			</ListBox.ItemContainerStyle>
			<ListBox.ItemTemplate>
				<DataTemplate>
					<Grid DoubleTapped="TagGrid_DoubleTapped" RightTapped="TagGrid_RightTapped">
						<StackPanel Orientation="Horizontal" Spacing="4">
							<TextBlock IsTextSelectionEnabled="True" Text="{Binding Value.TagName}"/>
							<TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}">
								<Run Text="("/>
								<Run Text="{Binding Count}"/>
								<Run Text=")"/>
							</TextBlock>
						</StackPanel>
						<FlyoutBase.AttachedFlyout>
							<MenuFlyout>
								<MenuFlyoutItem
									Text="Delete"
									Command="{Binding DataContext.RemoveTagCommand, ElementName=ControlRoot}"
									CommandParameter="{Binding }">
									<MenuFlyoutItem.Icon>
										<FontIcon Glyph="&#xE74D;" />
									</MenuFlyoutItem.Icon>
								</MenuFlyoutItem>
							</MenuFlyout>
						</FlyoutBase.AttachedFlyout>
					</Grid>
				</DataTemplate>
			</ListBox.ItemTemplate>
			<ListBox.ItemsPanel>
				<ItemsPanelTemplate>
					<controls:WrapPanel Orientation="Horizontal"/>
				</ItemsPanelTemplate>
			</ListBox.ItemsPanel>
		</ListBox>
	</StackPanel>
</local:DetailPaneBase>
