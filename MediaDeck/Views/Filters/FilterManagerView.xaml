<?xml version="1.0" encoding="utf-8"?>
<local:FilterManagerViewUserControl
	x:Class="MediaDeck.Views.Filters.FilterManagerView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:MediaDeck.Views.Filters"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:filteritemobjects="using:MediaDeck.Composition.Interfaces.Files"
	xmlns:creators="using:MediaDeck.ViewModels.Filters.FilterItemCreators"
	mc:Ignorable="d">

	<Grid x:Name="ControlRoot" Padding="12">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="220" />
			<ColumnDefinition Width="12" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>

		<!-- フィルター条件一覧 -->
		<Grid Grid.Column="0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="8" />
				<RowDefinition Height="*" />
				<RowDefinition Height="8" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>

			<TextBlock
				Grid.Row="0"
				Text="フィルター条件"
				FontWeight="SemiBold"
				FontSize="14" />

			<Border
				Grid.Row="2"
				BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="4">
				<ListBox
					ItemsSource="{x:Bind ViewModel.FilteringConditions}"
					SelectedItem="{x:Bind ViewModel.CurrentCondition.Value, Mode=TwoWay}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<TextBlock
								Text="{Binding DisplayName.Value, TargetNullValue=(名称未設定)}"
								TextTrimming="CharacterEllipsis" />
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ListBox>
			</Border>

			<StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="8">
				<Button
					Command="{x:Bind ViewModel.AddFilteringConditionCommand}"
					ToolTipService.ToolTip="新しいフィルター条件を追加">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<FontIcon Glyph="&#xF8AA;" FontSize="12" />
						<TextBlock Text="追加" />
					</StackPanel>
				</Button>
				<Button
					Command="{x:Bind ViewModel.RemoveFilteringConditionCommand}"
					CommandParameter="{x:Bind ViewModel.CurrentCondition.Value, Mode=OneWay}"
					ToolTipService.ToolTip="選択中のフィルター条件を削除">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<FontIcon Glyph="&#xF78A;" FontSize="12" />
						<TextBlock Text="削除" />
					</StackPanel>
				</Button>
			</StackPanel>
		</Grid>

		<!-- フィルター条件編集エリア -->
		<Border
			Grid.Column="2"
			Visibility="{x:Bind ViewModel.CurrentCondition.Value, Mode=OneWay, Converter={StaticResource NullToCollapseConverter}}"
			Padding="16"
			Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
			BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
			BorderThickness="1"
			CornerRadius="8">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="16" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="16" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>

				<!-- 条件名入力 -->
				<StackPanel Grid.Row="0" Spacing="6">
					<TextBlock Text="条件名" FontWeight="SemiBold" />
					<TextBox
						Text="{x:Bind ViewModel.CurrentCondition.Value.DisplayName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
						PlaceholderText="フィルター条件の名前を入力" />
				</StackPanel>

				<!-- フィルター項目追加 -->
				<StackPanel Grid.Row="2" Spacing="6">
					<TextBlock Text="フィルター項目を追加" FontWeight="SemiBold" />
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="8" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<ComboBox
							x:Name="FilterCreatorComboBox"
							Grid.Column="0"
							HorizontalAlignment="Stretch"
							PlaceholderText="フィルター項目を選択"
							SelectionChanged="FilterCreatorComboBox_SelectionChanged"
							ItemsSource="{x:Bind ViewModel.FilterCreatorViewModels, Mode=OneWay}"
							SelectedItem="{x:Bind ViewModel.SelectedFilterCreatorViewModel.Value, Mode=TwoWay}">
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="creators:IFilterCreatorViewModel">
									<TextBlock Text="{x:Bind Title, Mode=OneWay}" />
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ComboBox>
					</Grid>
					<Frame x:Name="ContentFrame" DataContext="{x:Bind ViewModel.SelectedFilterCreatorViewModel.Value, Mode=OneWay}" />
				</StackPanel>

				<!-- 適用済みフィルター一覧 -->
				<Grid Grid.Row="4">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="8" />
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>

					<TextBlock Grid.Row="0" Text="適用中のフィルター項目" FontWeight="SemiBold" />

					<Border
						Grid.Row="2"
						BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
						BorderThickness="1"
						CornerRadius="4">
						<ItemsControl ItemsSource="{x:Bind ViewModel.CurrentCondition.Value.FilterItems, Mode=OneWay}">
							<ItemsControl.ItemTemplate>
								<DataTemplate x:DataType="filteritemobjects:IFilterItemObject">
									<Grid Padding="8" BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*" />
											<ColumnDefinition Width="Auto" />
										</Grid.ColumnDefinitions>
										<TextBlock
											Grid.Column="0"
											Text="{x:Bind DisplayName}"
											VerticalAlignment="Center" />
										<Button
											Grid.Column="1"
											Command="{Binding DataContext.CurrentCondition.Value.RemoveFilterCommand, Mode=OneWay, ElementName=ControlRoot}"
											CommandParameter="{Binding Mode=OneWay}"
											ToolTipService.ToolTip="このフィルター項目を削除"
											Padding="6">
											<FontIcon Glyph="&#xF78A;" FontSize="12" />
										</Button>
									</Grid>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</Border>
				</Grid>
			</Grid>
		</Border>
	</Grid>
</local:FilterManagerViewUserControl>
