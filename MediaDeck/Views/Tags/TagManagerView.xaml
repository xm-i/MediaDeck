<?xml version="1.0" encoding="utf-8"?>
<local:TagManagerViewUserControl
	x:Class="MediaDeck.Views.Tags.TagManagerView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:MediaDeck.Views.Tags"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:tags="using:MediaDeck.ViewModels.Tags"
	mc:Ignorable="d">

	<Grid x:Name="Root" Padding="12">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="220" />
			<ColumnDefinition Width="12" />
			<ColumnDefinition Width="220" />
			<ColumnDefinition Width="12" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>

		<!-- タグカテゴリ一覧 -->
		<Grid Grid.Column="0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="8" />
				<RowDefinition Height="*" />
				<RowDefinition Height="8" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="8" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>

			<TextBlock
				Grid.Row="0"
				Text="タグカテゴリ"
				FontWeight="SemiBold"
				FontSize="14" />

			<Border
				Grid.Row="2"
				BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="4">
				<ListBox
					ItemsSource="{x:Bind ViewModel.TagCategories, Mode=OneWay}"
					SelectedItem="{x:Bind ViewModel.SelectedTagCategory.Value, Mode=TwoWay}">
					<ItemsControl.ItemTemplate>
						<DataTemplate x:DataType="tags:TagCategoryViewModel">
							<TextBlock
								Text="{x:Bind TagCategoryName.Value}"
								TextTrimming="CharacterEllipsis" />
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ListBox>
			</Border>

			<StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="8">
				<Button
					Command="{x:Bind ViewModel.AddTagCategoryCommand}"
					ToolTipService.ToolTip="新しいタグカテゴリを追加">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<FontIcon Glyph="&#xF8AA;" FontSize="12" />
						<TextBlock Text="追加" />
					</StackPanel>
				</Button>
			</StackPanel>

			<!-- カテゴリ編集エリア -->
			<StackPanel
				Grid.Row="6"
				Spacing="6"
				Visibility="{x:Bind ViewModel.SelectedTagCategory.Value, Mode=OneWay, Converter={StaticResource NullToCollapseConverter}}">
				<TextBlock Text="カテゴリ名" FontWeight="SemiBold" />
				<TextBox
					Text="{x:Bind ViewModel.SelectedTagCategory.Value.TagCategoryName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
					PlaceholderText="カテゴリ名を入力" />
				<TextBlock Text="詳細" FontWeight="SemiBold" />
				<TextBox
					Text="{x:Bind ViewModel.SelectedTagCategory.Value.Detail.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
					PlaceholderText="詳細を入力" />
			</StackPanel>
		</Grid>

		<!-- タグ一覧 -->
		<Grid Grid.Column="2">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="8" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="8" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<TextBlock
				Grid.Row="0"
				Text="タグ"
				FontWeight="SemiBold"
				FontSize="14" />

			<TextBox
				Grid.Row="2"
				Text="{x:Bind ViewModel.SelectedTagCategory.Value.FilterText.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
				PlaceholderText="タグを検索..." />

			<Border
				Grid.Row="4"
				BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="4">
				<ListBox
					ItemsSource="{x:Bind ViewModel.SelectedTagCategory.Value.FilteredTags, Mode=OneWay}"
					SelectedItem="{x:Bind ViewModel.SelectedTagCategory.Value.SelectedTag.Value, Mode=TwoWay}">
					<ItemsControl.ItemTemplate>
						<DataTemplate x:DataType="tags:TagViewModel">
							<StackPanel Spacing="2">
								<TextBlock
									Text="{x:Bind TagName.Value}"
									TextTrimming="CharacterEllipsis" />
								<TextBlock
									Visibility="{x:Bind RepresentativeTextForSearch.Value, Mode=OneWay, Converter={StaticResource NullToCollapseConverter}}"
									Text="{x:Bind RepresentativeTextForSearch.Value, Mode=OneWay}"
									FontSize="10"
									Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
							</StackPanel>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ListBox>
			</Border>
		</Grid>

		<!-- タグ編集エリア -->
		<Border
			Grid.Column="4"
			Visibility="{x:Bind ViewModel.SelectedTagCategory.Value.SelectedTag.Value, Mode=OneWay, Converter={StaticResource NullToCollapseConverter}}"
			Padding="16"
			Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
			BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
			BorderThickness="1"
			CornerRadius="8">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="16" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="16" />
					<RowDefinition Height="*" />
					<RowDefinition Height="8" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

				<!-- タグ名入力 -->
				<StackPanel Grid.Row="0" Spacing="6">
					<TextBlock Text="タグ名" FontWeight="SemiBold" />
					<TextBox
						Text="{x:Bind ViewModel.SelectedTagCategory.Value.SelectedTag.Value.TagName.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
						PlaceholderText="タグ名を入力" />
				</StackPanel>

				<!-- カテゴリ選択 -->
				<StackPanel Grid.Row="2" Spacing="6">
					<TextBlock Text="所属カテゴリ" FontWeight="SemiBold" />
					<ComboBox
						HorizontalAlignment="Stretch"
						ItemsSource="{x:Bind ViewModel.TagCategories, Mode=OneWay}"
						SelectedItem="{x:Bind ViewModel.SelectedTagCategory.Value.SelectedTag.Value.TagCategory.Value, Mode=TwoWay}">
						<ComboBox.ItemTemplate>
							<DataTemplate x:DataType="tags:TagCategoryViewModel">
								<TextBlock Text="{x:Bind TagCategoryName.Value}" />
							</DataTemplate>
						</ComboBox.ItemTemplate>
					</ComboBox>
				</StackPanel>

				<!-- エイリアス一覧 -->
				<Grid Grid.Row="4">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="8" />
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>

					<TextBlock Grid.Row="0" Text="タグエイリアス" FontWeight="SemiBold" />

					<Border
						Grid.Row="2"
						BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
						BorderThickness="1"
						CornerRadius="4">
						<ScrollViewer>
							<ItemsControl ItemsSource="{x:Bind ViewModel.SelectedTagCategory.Value.SelectedTag.Value.TagAliases, Mode=OneWay}">
								<ItemsControl.ItemTemplate>
									<DataTemplate x:DataType="tags:TagAliasViewModel">
										<Grid Padding="8" BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="*" />
												<ColumnDefinition Width="8" />
												<ColumnDefinition Width="*" />
												<ColumnDefinition Width="8" />
												<ColumnDefinition Width="Auto" />
											</Grid.ColumnDefinitions>
											<TextBox
												Grid.Column="0"
												Text="{x:Bind Alias.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
												PlaceholderText="エイリアス" />
											<TextBox
												Grid.Column="2"
												Text="{x:Bind Ruby.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
												PlaceholderText="ふりがな" />
											<Button
												Grid.Column="4"
												Command="{Binding DataContext.SelectedTagCategory.Value.SelectedTag.Value.RemoveTagAliasCommand, ElementName=Root}"
												CommandParameter="{x:Bind Mode=OneWay}"
												ToolTipService.ToolTip="このエイリアスを削除"
												Padding="6">
												<FontIcon Glyph="&#xF78A;" FontSize="12" />
											</Button>
										</Grid>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</ScrollViewer>
					</Border>
				</Grid>

				<!-- エイリアス追加ボタン -->
				<Button
					Grid.Row="6"
					Command="{x:Bind ViewModel.SelectedTagCategory.Value.SelectedTag.Value.AddTagAliasCommand, Mode=OneWay}"
					ToolTipService.ToolTip="新しいエイリアスを追加">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<FontIcon Glyph="&#xF8AA;" FontSize="12" />
						<TextBlock Text="エイリアスを追加" />
					</StackPanel>
				</Button>
			</Grid>
		</Border>
	</Grid>
</local:TagManagerViewUserControl>
