<?xml version="1.0" encoding="utf-8"?>
<local:FolderManagerViewUserControl
	x:Class="MediaDeck.Views.FolderManager.FolderManagerView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="using:MediaDeck.Views.FolderManager"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:folderManagerVm="using:MediaDeck.ViewModels.FolderManager"
	mc:Ignorable="d">

	<Grid x:Name="Root" Padding="12">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="300" />
			<ColumnDefinition Width="12" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>

		<!-- フォルダ一覧 -->
		<Grid Grid.Column="0">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="8" />
				<RowDefinition Height="*" />
				<RowDefinition Height="8" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>

			<TextBlock
				Grid.Row="0"
				Text="登録フォルダ"
				FontWeight="SemiBold"
				FontSize="14" />

			<Border
				Grid.Row="2"
				BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="4">
				<ListBox
					ItemsSource="{x:Bind ViewModel.Folders}"
					SelectedItem="{x:Bind ViewModel.SelectedFolder.Value, Mode=TwoWay}">
					<ItemsControl.ItemTemplate>
						<DataTemplate x:DataType="folderManagerVm:FolderViewModel">
							<Grid Padding="4,8">
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto" />
									<RowDefinition Height="4" />
									<RowDefinition Height="Auto" />
								</Grid.RowDefinitions>
								<TextBlock
									Grid.Row="0"
									Text="{x:Bind FolderPath}"
									TextTrimming="CharacterEllipsis">
									<TextBlock.ContextFlyout>
										<MenuFlyout>
											<MenuFlyoutItem Text="削除" Click="MenuFlyoutItem_Click" Tag="Remove" />
										</MenuFlyout>
									</TextBlock.ContextFlyout>
								</TextBlock>
								<StackPanel Grid.Row="2" Spacing="4">
									<ProgressBar
										Value="{x:Bind ProcessedCount.Value, Mode=OneWay, Converter={StaticResource LongToDoubleConverter}}"
										Maximum="{x:Bind TotalCount.Value, Mode=OneWay, Converter={StaticResource LongToDoubleConverter}}"
										Visibility="{x:Bind IsScanning.Value, Mode=OneWay}"
										Height="4" />
									<TextBlock
										FontSize="11"
										Foreground="{ThemeResource TextFillColorSecondaryBrush}"
										Visibility="{x:Bind IsScanning.Value, Mode=OneWay}">
										<Run Text="処理中..."/>
										<Run Text="{x:Bind ProcessedCount.Value, Mode=OneWay}"/>
										<Run Text="/"/>
										<Run Text="{x:Bind TotalCount.Value, Mode=OneWay}"/>
										<Run Text="件"/>
									</TextBlock>
									<TextBlock
										FontSize="11"
										Foreground="{ThemeResource TextFillColorSecondaryBrush}"
										Visibility="{x:Bind IsScanning.Value, Mode=OneWay, Converter={StaticResource InvertBoolToVisibilityConverter}}">
										<Run Text="{x:Bind TotalCount.Value, Mode=OneWay}"/>
										<Run Text="件"/>
									</TextBlock>
								</StackPanel>
							</Grid>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ListBox>
			</Border>

			<StackPanel Grid.Row="4" Orientation="Horizontal" Spacing="8">
				<Button
					x:Name="AddFolderButton"
					Click="AddFolderButton_Click"
					ToolTipService.ToolTip="新しいフォルダを追加">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<FontIcon Glyph="&#xF8AA;" FontSize="12" />
						<TextBlock Text="追加" />
					</StackPanel>
				</Button>
				<Button
					Command="{x:Bind ViewModel.RemoveFolderCommand}"
					CommandParameter="{x:Bind ViewModel.SelectedFolder.Value, Mode=OneWay}"
					ToolTipService.ToolTip="選択中のフォルダを削除">
					<StackPanel Orientation="Horizontal" Spacing="6">
						<FontIcon Glyph="&#xF78A;" FontSize="12" />
						<TextBlock Text="削除" />
					</StackPanel>
				</Button>
			</StackPanel>
		</Grid>

		<!-- スキャン操作エリア -->
		<Border
			Grid.Column="2"
			Padding="16"
			Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
			BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
			BorderThickness="1"
			CornerRadius="8">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

				<!-- スキャン操作 -->
				<StackPanel Grid.Row="0" Spacing="6">
					<TextBlock Text="スキャン" FontWeight="SemiBold" />
					<StackPanel Orientation="Horizontal" Spacing="8">
						<Button
							Command="{x:Bind ViewModel.ScanCommand}"
							Style="{StaticResource AccentButtonStyle}"
							ToolTipService.ToolTip="すべてのフォルダをスキャン">
							<StackPanel Orientation="Horizontal" Spacing="6">
								<FontIcon Glyph="&#xE721;" FontSize="12" />
								<TextBlock Text="すべてスキャン" />
							</StackPanel>
						</Button>
						<Button
							Command="{x:Bind ViewModel.ScanSelectedFolderCommand}"
							CommandParameter="{x:Bind ViewModel.SelectedFolder.Value, Mode=OneWay}"
							ToolTipService.ToolTip="選択中のフォルダのみスキャン">
							<StackPanel Orientation="Horizontal" Spacing="6">
								<FontIcon Glyph="&#xE8B7;" FontSize="12" />
								<TextBlock Text="選択フォルダをスキャン" />
							</StackPanel>
						</Button>
					</StackPanel>
				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</local:FolderManagerViewUserControl>
